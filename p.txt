
az rest --method post \
  --url "https://management.azure.com/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.ApiManagement/service/<APIM_NAME>/namedValues/<NAMED_VALUE_ID>/refreshSecret?api-version=2024-05-01"




APIM_URL="/subscriptions/$subscriptionId/resourceGroups/$resourceGroup/providers/Microsoft.ApiManagement/service/$serviceName/apis/$apiName/policies/policy?api-version=$API_VERSION"

# --- 3. Prepare the JSON Payload ---
# Read the XML, remove newlines (tr -d '\n'), and escape internal quotes (sed 's/"/\\"/g')
policy_content=$(cat "$FilePath" | tr -d '\n' | sed 's/"/\\"/g')

# Construct the required JSON body for the PUT operation
json_body="{\"properties\":{\"format\":\"rawxml\",\"value\":\"$policy_content\"}}"

# --- 4. Execute the PUT request ---
echo "Uploading policy for API '$apiName'..."

az rest --method PUT --url "$APIM_URL" --body "$json_body" --output none

echo "Policy update complete for API: $apiName"
